<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Zen Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Versión 18) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (para JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Dependencia Prop-types (Necesaria para algunas versiones UMD de Recharts) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <!-- Recharts (Versión específica estable para UMD) -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Animaciones personalizadas */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .slide-in-bottom { animation: slideInBottom 0.5s ease-out; }
        .slide-in-right { animation: slideInRight 0.5s ease-out; }
        .zoom-in { animation: zoomIn 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInBottom { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- Setup e Importaciones ---
        const { useState, useEffect, useMemo, useRef } = React;
        
        // Verificación de seguridad para Recharts
        const { 
            PieChart, Pie, Cell, ResponsiveContainer, Tooltip: RechartsTooltip, Legend,
            BarChart, Bar, XAxis, YAxis, CartesianGrid, AreaChart, Area 
        } = window.Recharts || {};

        if (!window.Recharts) {
            console.error("Error crítico: Recharts no se cargó correctamente.");
        }

        // --- Configuración API Gemini ---
        const apiKey = ""; // La clave se inyectará automáticamente en el entorno de ejecución

        const callGeminiText = async (prompt) => {
            try {
                // Nota: En un entorno de producción real, nunca expongas tu API Key en el frontend.
                // Usa un backend proxy. Aquí se hace directo por demostración.
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    }
                );
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                throw error;
            }
        };

        // --- Iconos (SVG Components) ---
        // Definimos los iconos manualmente para evitar dependencias externas complejas en un solo archivo
        const Icon = ({ path, size = 24, className = "", strokeWidth = 2, color = "currentColor" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke={color} 
                strokeWidth={strokeWidth} 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            LayoutDashboard: (props) => <Icon {...props} path={<><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></>} />,
            Wallet: (props) => <Icon {...props} path={<><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></>} />,
            DollarSign: (props) => <Icon {...props} path={<><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></>} />,
            PieChart: (props) => <Icon {...props} path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Check: (props) => <Icon {...props} path={<path d="M20 6 9 17l-5-5"/>} />,
            Sparkles: (props) => <Icon {...props} path={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></>} />,
            X: (props) => <Icon {...props} path={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} />,
            Loader2: (props) => <Icon {...props} className={`animate-spin ${props.className}`} path={<path d="M21 12a9 9 0 1 1-6.219-8.56" />} />,
            Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            TrendingUp: (props) => <Icon {...props} path={<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>} />,
            Home: (props) => <Icon {...props} path={<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>} />,
            Menu: (props) => <Icon {...props} path={<><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></>} />,
        };

        // --- Componentes UI ---
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-2xl shadow-sm border border-slate-100 p-6 transition-all hover:shadow-md ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, variant = "primary", className = "", type = "button", disabled = false }) => {
            const baseStyle = "px-4 py-3 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-slate-900 text-white hover:bg-slate-800 shadow-lg shadow-slate-200",
                secondary: "bg-slate-100 text-slate-600 hover:bg-slate-200",
                danger: "bg-red-50 text-red-500 hover:bg-red-100",
                ghost: "text-slate-500 hover:bg-slate-50 hover:text-slate-900",
                ai: "bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-purple-200 hover:shadow-xl hover:scale-[1.02]"
            };
            return (
                <button type={type} onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm fade-in">
                    <div className="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl zoom-in relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                            <Icons.X size={24} />
                        </button>
                        <h3 className="text-xl font-bold text-slate-800 mb-4">{title}</h3>
                        {children}
                    </div>
                </div>
            );
        };

        const ProgressBar = ({ value, max, colorClass = "bg-slate-900" }) => {
            const percentage = Math.min(100, Math.max(0, (value / max) * 100));
            return (
                <div className="h-3 w-full bg-slate-100 rounded-full overflow-hidden">
                    <div 
                        className={`h-full transition-all duration-500 ${colorClass}`} 
                        style={{ width: `${percentage}%` }}
                    />
                </div>
            );
        };

        const SidebarItem = ({ icon, label, active, onClick }) => (
            <button 
                onClick={onClick}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 font-medium text-sm group ${active ? 'bg-slate-900 text-white shadow-lg shadow-slate-200' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-900'}`}
            >
                <span className={`${active ? 'text-white' : 'text-slate-400 group-hover:text-slate-900'}`}>{icon}</span>
                {label}
            </button>
        );

        const KPICard = ({ title, amount, trend, currency }) => (
            <Card className="flex flex-col justify-between">
                <div className="flex justify-between items-start mb-2">
                    <h3 className="text-slate-500 text-sm font-medium">{title}</h3>
                    <div className={`p-1.5 rounded-lg ${trend === 'up' ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'}`}>
                        {trend === 'up' ? <Icons.TrendingUp size={16} /> : <Icons.TrendingUp size={16} className="rotate-180" />}
                    </div>
                </div>
                <div>
                    <span className={`text-3xl font-bold tracking-tight ${amount < 0 ? 'text-rose-600' : 'text-slate-900'}`}>
                        {formatMoney(amount, currency)}
                    </span>
                </div>
            </Card>
        );

        // --- Utilidades ---
        const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#6366f1', '#14b8a6'];

        const DEFAULT_CATEGORIES = [
            "Comida", "Transporte", "Hogar", "Servicios", 
            "Entretenimiento", "Salud", "Educación", "Regalos"
        ];

        const formatMoney = (amount, currency) => {
            return new Intl.NumberFormat('es-AR', {
                style: 'currency',
                currency: currency,
                maximumFractionDigits: 0
            }).format(amount);
        };

        const getGreeting = () => {
            const hour = new Date().getHours();
            if (hour < 12) return "Buenos días";
            if (hour < 20) return "Buenas tardes";
            return "Buenas noches";
        };

        const exportToCSV = (transactions) => {
            const headers = ["ID", "Fecha", "Tipo", "Categoría", "Monto", "Moneda"];
            const rows = transactions.map(t => [
                t.id, t.date, t.type, t.category, t.amount, t.currency
            ]);
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + [headers.join(","), ...rows.map(e => e.join(","))].join("\n");
                
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `finanzas_zen_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- Main App ---
        function App() {
            const [view, setView] = useState('dashboard'); // 'dashboard' | 'entry' | 'budgets'
            const [transactions, setTransactions] = useState([]);
            const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
            const [budgets, setBudgets] = useState({});
            
            // Form State
            const [amount, setAmount] = useState('');
            const [type, setType] = useState('expense');
            const [currency, setCurrency] = useState('ARS');
            const [category, setCategory] = useState('Comida');
            const [customCategory, setCustomCategory] = useState('');
            const [isCustomCat, setIsCustomCat] = useState(false);
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);

            // AI State
            const [isGeneratingAdvice, setIsGeneratingAdvice] = useState(false);
            const [aiAdvice, setAiAdvice] = useState(null);

            // Filter State
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7)); // YYYY-MM
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false); // Mobile menu toggle

            // --- Persistencia ---
            useEffect(() => {
                const savedData = localStorage.getItem('finanzas_zen_data');
                const savedCats = localStorage.getItem('finanzas_zen_cats');
                const savedBudgets = localStorage.getItem('finanzas_zen_budgets');
                
                if (savedData) setTransactions(JSON.parse(savedData));
                if (savedCats) setCategories(JSON.parse(savedCats));
                if (savedBudgets) setBudgets(JSON.parse(savedBudgets));
            }, []);

            useEffect(() => {
                localStorage.setItem('finanzas_zen_data', JSON.stringify(transactions));
                localStorage.setItem('finanzas_zen_cats', JSON.stringify(categories));
                localStorage.setItem('finanzas_zen_budgets', JSON.stringify(budgets));
            }, [transactions, categories, budgets]);

            // --- Lógica AI ---
            const generateZenAdvice = async () => {
                setIsGeneratingAdvice(true);
                
                const monthlyTrans = transactions.filter(t => t.date.startsWith(selectedMonth));
                const summary = {
                    totalIncome: monthlyTrans.filter(t => t.type === 'income').reduce((acc, t) => acc + t.amount, 0),
                    totalExpense: monthlyTrans.filter(t => t.type === 'expense').reduce((acc, t) => acc + t.amount, 0),
                    categories: monthlyTrans.filter(t => t.type === 'expense').map(t => ({c: t.category, a: t.amount})),
                };

                const prompt = `
                    Actúa como un analista financiero personal inteligente. Analiza estos datos del mes: ${JSON.stringify(summary)}.
                    Dame:
                    1. Un resumen ejecutivo de una frase.
                    2. Una "Alerta" o "Logro" destacado (si gastó mucho en algo o si ahorró).
                    3. Una recomendación accionable para el próximo mes.
                    Tono: Profesional pero cercano. Usa formato simple.
                `;

                try {
                    const advice = await callGeminiText(prompt);
                    setAiAdvice(advice);
                } catch (error) {
                    alert("Servicio no disponible momentáneamente (Configura la API Key).");
                } finally {
                    setIsGeneratingAdvice(false);
                }
            };

            // --- Lógica Negocio ---
            const handleSubmit = (e) => {
                e.preventDefault();
                if (!amount || parseFloat(amount) <= 0) return;

                let finalCategory = category;
                if (isCustomCat && customCategory.trim() !== "") {
                    finalCategory = customCategory.trim();
                    if (!categories.includes(finalCategory)) {
                        setCategories([...categories, finalCategory]);
                    }
                } else if (type === 'income') {
                    finalCategory = 'Ingreso';
                }

                const newTransaction = {
                    id: crypto.randomUUID(),
                    amount: parseFloat(amount),
                    type,
                    currency,
                    category: finalCategory,
                    date,
                    createdAt: new Date().toISOString()
                };

                setTransactions([newTransaction, ...transactions]);
                setAmount('');
                setCustomCategory('');
                setIsCustomCat(false);
            };

            const handleBudgetChange = (cat, val) => {
                setBudgets(prev => ({ ...prev, [cat]: parseFloat(val) || 0 }));
            };

            const handleDelete = (id) => setTransactions(transactions.filter(t => t.id !== id));

            // --- Cálculos Dashboard ---
            const filteredTransactions = useMemo(() => {
                return transactions.filter(t => t.date.startsWith(selectedMonth));
            }, [transactions, selectedMonth]);

            const totals = useMemo(() => {
                return filteredTransactions.reduce((acc, curr) => {
                    const key = curr.currency;
                    if (!acc[key]) acc[key] = { income: 0, expense: 0 };
                    if (curr.type === 'income') acc[key].income += curr.amount;
                    else acc[key].expense += curr.amount;
                    return acc;
                }, {});
            }, [filteredTransactions]);

            const expensesByCategory = useMemo(() => {
                const data = {};
                filteredTransactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        const key = t.category;
                        if (!data[key]) data[key] = 0;
                        data[key] += t.amount;
                    });
                return Object.keys(data).map(key => ({ name: key, value: data[key] }));
            }, [filteredTransactions]);

            const monthlyData = useMemo(() => {
                const data = [];
                for (let i = 5; i >= 0; i--) {
                    const d = new Date();
                    d.setMonth(d.getMonth() - i);
                    const monthStr = d.toISOString().slice(0, 7);
                    const monthTrans = transactions.filter(t => t.date.startsWith(monthStr) && t.currency === 'ARS');
                    const income = monthTrans.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                    const expense = monthTrans.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                    data.push({
                        name: d.toLocaleDateString('es-ES', { month: 'short' }),
                        Ingresos: income,
                        Gastos: expense
                    });
                }
                return data;
            }, [transactions]);

            // --- Vistas ---
            const BudgetsView = () => (
                <div className="space-y-6 slide-in-right">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-bold text-slate-800">Presupuestos Mensuales (ARS)</h2>
                        <p className="text-slate-500 text-sm">Define tus límites para mantener el control.</p>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {categories.map(cat => {
                            const spent = filteredTransactions
                                .filter(t => t.category === cat && t.type === 'expense' && t.currency === 'ARS')
                                .reduce((sum, t) => sum + t.amount, 0);
                            const budget = budgets[cat] || 0;
                            const percentage = budget > 0 ? (spent / budget) * 100 : 0;
                            
                            let color = "bg-emerald-500";
                            if (percentage > 75) color = "bg-amber-500";
                            if (percentage > 100) color = "bg-rose-500";

                            return (
                                <Card key={cat} className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span className="font-bold text-slate-700">{cat}</span>
                                        <input 
                                            type="number" 
                                            placeholder="Límite..."
                                            value={budgets[cat] || ''}
                                            onChange={(e) => handleBudgetChange(cat, e.target.value)}
                                            className="w-24 text-right border-b border-slate-200 focus:border-slate-900 focus:outline-none bg-transparent text-sm"
                                        />
                                    </div>
                                    <div className="flex justify-between text-xs text-slate-400">
                                        <span>Gastado: {formatMoney(spent, 'ARS')}</span>
                                        <span>Meta: {budget > 0 ? formatMoney(budget, 'ARS') : 'Sin límite'}</span>
                                    </div>
                                    <ProgressBar value={spent} max={budget || spent * 1.5} colorClass={color} />
                                    {percentage > 100 && <span className="text-xs text-rose-500 font-bold">¡Presupuesto excedido!</span>}
                                </Card>
                            );
                        })}
                    </div>
                </div>
            );

            // --- Render ---
            return (
                <div className="flex h-screen bg-slate-50 text-slate-800 font-sans selection:bg-slate-200 overflow-hidden">
                    
                    {/* Sidebar Desktop */}
                    <aside className="hidden md:flex flex-col w-64 bg-white border-r border-slate-200 h-full p-6 shadow-[4px_0_24px_rgba(0,0,0,0.02)] z-20">
                        <div className="flex items-center gap-3 mb-10 pl-2">
                            <div className="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white shadow-lg shadow-slate-200">
                                <Icons.DollarSign size={24} strokeWidth={3} />
                            </div>
                            <div>
                                <h1 className="text-xl font-bold tracking-tight text-slate-900 leading-none">Finanzas</h1>
                                <span className="text-xs font-bold text-slate-400 tracking-widest uppercase">Zen Pro</span>
                            </div>
                        </div>

                        <nav className="flex-1 space-y-2">
                            <SidebarItem icon={<Icons.Home size={20}/>} label="Dashboard" active={view === 'dashboard'} onClick={() => setView('dashboard')} />
                            <SidebarItem icon={<Icons.Plus size={20}/>} label="Nuevo Movimiento" active={view === 'entry'} onClick={() => setView('entry')} />
                            <SidebarItem icon={<Icons.Target size={20}/>} label="Presupuestos" active={view === 'budgets'} onClick={() => setView('budgets')} />
                        </nav>

                        <div className="pt-6 border-t border-slate-100 space-y-4">
                            <div className="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <p className="text-xs font-semibold text-slate-400 mb-2 uppercase">Tu Resumen</p>
                                <p className="text-2xl font-bold text-slate-800">{formatMoney(totals['ARS']?.income - totals['ARS']?.expense || 0, 'ARS')}</p>
                            </div>
                            <button onClick={() => exportToCSV(transactions)} className="flex items-center gap-2 text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors w-full px-2">
                                <Icons.Download size={16} /> Exportar CSV
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col h-full overflow-hidden relative">
                        
                        {/* Top Header Desktop */}
                        <header className="h-20 bg-white/80 backdrop-blur-md border-b border-slate-200 flex items-center justify-between px-8 sticky top-0 z-10">
                            <div>
                                <h2 className="text-xl font-bold text-slate-800">{getGreeting()}</h2>
                                <p className="text-sm text-slate-500">{new Date().toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <input 
                                    type="month" 
                                    value={selectedMonth} 
                                    onChange={(e) => setSelectedMonth(e.target.value)}
                                    className="bg-slate-50 border border-slate-200 rounded-xl px-4 py-2 text-sm font-medium text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-900 hover:bg-slate-100 transition-colors cursor-pointer"
                                />
                                <div className="w-10 h-10 rounded-full bg-slate-200 border-2 border-white shadow-sm overflow-hidden flex items-center justify-center text-slate-400 font-bold">
                                    USER
                                </div>
                            </div>
                        </header>

                        {/* Scrollable Area */}
                        <main className="flex-1 overflow-y-auto p-4 md:p-8 pb-32 md:pb-8">
                            <div className="max-w-6xl mx-auto">
                                {view === 'dashboard' && (
                                    <div className="space-y-8 slide-in-bottom">
                                        
                                        {/* Botón IA */}
                                        <div className="flex justify-end">
                                            <Button 
                                                onClick={generateZenAdvice} 
                                                variant="ai" 
                                                className="px-4 py-2 text-sm"
                                                disabled={isGeneratingAdvice}
                                            >
                                                {isGeneratingAdvice ? <Icons.Loader2 className="animate-spin" size={16}/> : <Icons.Sparkles size={16}/>}
                                                {isGeneratingAdvice ? 'Analizando...' : 'Análisis Inteligente'}
                                            </Button>
                                        </div>

                                        {/* KPIs */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <KPICard 
                                                title="Balance Total (ARS)" 
                                                amount={totals['ARS']?.income - totals['ARS']?.expense || 0} 
                                                trend={totals['ARS']?.income > totals['ARS']?.expense ? 'up' : 'down'}
                                                currency="ARS"
                                            />
                                            <KPICard 
                                                title="Balance Total (USD)" 
                                                amount={totals['USD']?.income - totals['USD']?.expense || 0} 
                                                trend={totals['USD']?.income > totals['USD']?.expense ? 'up' : 'down'}
                                                currency="USD"
                                            />
                                            <Card className="flex flex-col justify-center items-center bg-slate-900 text-white border-none">
                                                <span className="text-slate-400 text-sm font-medium mb-1">Movimientos del mes</span>
                                                <span className="text-4xl font-bold">{filteredTransactions.length}</span>
                                            </Card>
                                        </div>

                                        {/* Gráficos */}
                                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-auto lg:h-[400px]">
                                            <Card className="lg:col-span-2 flex flex-col h-[400px] lg:h-auto">
                                                <h3 className="text-slate-800 font-bold mb-6 flex items-center gap-2">
                                                    <Icons.TrendingUp size={20} className="text-emerald-500"/> Flujo de Caja (Últimos 6 meses)
                                                </h3>
                                                <div className="flex-1 min-h-0">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <AreaChart data={monthlyData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
                                                            <defs>
                                                                <linearGradient id="colorIngresos" x1="0" y1="0" x2="0" y2="1">
                                                                    <stop offset="5%" stopColor="#10b981" stopOpacity={0.1}/>
                                                                    <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                                                                </linearGradient>
                                                                <linearGradient id="colorGastos" x1="0" y1="0" x2="0" y2="1">
                                                                    <stop offset="5%" stopColor="#ef4444" stopOpacity={0.1}/>
                                                                    <stop offset="95%" stopColor="#ef4444" stopOpacity={0}/>
                                                                </linearGradient>
                                                            </defs>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                            <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 12}} />
                                                            <YAxis axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 12}} />
                                                            <RechartsTooltip contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'}} />
                                                            <Area type="monotone" dataKey="Ingresos" stroke="#10b981" strokeWidth={3} fillOpacity={1} fill="url(#colorIngresos)" />
                                                            <Area type="monotone" dataKey="Gastos" stroke="#ef4444" strokeWidth={3} fillOpacity={1} fill="url(#colorGastos)" />
                                                        </AreaChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </Card>

                                            <Card className="flex flex-col h-[400px] lg:h-auto">
                                                <h3 className="text-slate-800 font-bold mb-6 flex items-center gap-2">
                                                    <Icons.PieChart size={20} className="text-blue-500"/> Gastos por Categoría
                                                </h3>
                                                <div className="flex-1 min-h-0">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <PieChart>
                                                            <Pie
                                                                data={expensesByCategory}
                                                                innerRadius={60}
                                                                outerRadius={80}
                                                                paddingAngle={5}
                                                                dataKey="value"
                                                            >
                                                                {expensesByCategory.map((entry, index) => (
                                                                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                                                ))}
                                                            </Pie>
                                                            <RechartsTooltip formatter={(value) => formatMoney(value, 'ARS')} contentStyle={{borderRadius: '12px'}}/>
                                                            <Legend verticalAlign="bottom" height={36}/>
                                                        </PieChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </Card>
                                        </div>

                                        {/* Tabla Reciente */}
                                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                            <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                                <h3 className="font-bold text-slate-800">Transacciones Recientes</h3>
                                            </div>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm text-left">
                                                    <thead className="text-xs text-slate-500 uppercase bg-slate-50">
                                                        <tr>
                                                            <th className="px-6 py-3 font-medium">Categoría</th>
                                                            <th className="px-6 py-3 font-medium">Fecha</th>
                                                            <th className="px-6 py-3 font-medium text-right">Monto</th>
                                                            <th className="px-6 py-3 font-medium text-center">Acción</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {filteredTransactions.length === 0 ? (
                                                            <tr>
                                                                <td colSpan="4" className="text-center py-8 text-slate-400">Sin movimientos</td>
                                                            </tr>
                                                        ) : (
                                                            filteredTransactions.slice(0, 10).map((t) => (
                                                                <tr key={t.id} className="border-b border-slate-50 hover:bg-slate-50/50 transition-colors">
                                                                    <td className="px-6 py-4 font-medium text-slate-900 flex items-center gap-2">
                                                                        <div className={`w-2 h-2 rounded-full ${t.type === 'income' ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>
                                                                        {t.category}
                                                                    </td>
                                                                    <td className="px-6 py-4 text-slate-500">{t.date}</td>
                                                                    <td className={`px-6 py-4 text-right font-bold ${t.type === 'income' ? 'text-emerald-600' : 'text-slate-700'}`}>
                                                                        {t.type === 'income' ? '+' : '-'}{formatMoney(t.amount, t.currency)}
                                                                    </td>
                                                                    <td className="px-6 py-4 text-center">
                                                                        <button onClick={() => handleDelete(t.id)} className="text-slate-300 hover:text-rose-500 transition-colors">
                                                                            <Icons.Trash2 size={16} />
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            ))
                                                        )}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {view === 'budgets' && <BudgetsView />}

                                {view === 'entry' && (
                                    <div className="zoom-in max-w-xl mx-auto py-10">
                                        <Card className="space-y-8 shadow-xl shadow-slate-200/50 border-0 ring-1 ring-slate-100">
                                            <div className="text-center">
                                                <h2 className="text-2xl font-bold text-slate-900">Nuevo Movimiento</h2>
                                                <p className="text-slate-500">Registra tus ingresos o gastos manualmente.</p>
                                            </div>
                                            
                                            <div className="flex p-1 bg-slate-100 rounded-xl">
                                                {['expense', 'income'].map((t) => (
                                                    <button 
                                                        key={t}
                                                        onClick={() => setType(t)}
                                                        className={`flex-1 py-3 rounded-lg text-sm font-bold transition-all ${type === t ? 'bg-white shadow-sm text-slate-900' : 'text-slate-400 hover:text-slate-600'}`}
                                                    >
                                                        {t === 'expense' ? 'Egreso' : 'Ingreso'}
                                                    </button>
                                                ))}
                                            </div>

                                            <form onSubmit={handleSubmit} className="space-y-6">
                                                <div>
                                                    <label className="block text-xs font-bold text-slate-400 uppercase mb-2 ml-1">Monto Total</label>
                                                    <div className="flex gap-3">
                                                        <div className="relative flex-1 group">
                                                            <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-slate-900 transition-colors font-bold text-xl">$</span>
                                                            <input 
                                                                type="number" 
                                                                step="0.01" 
                                                                value={amount}
                                                                onChange={(e) => setAmount(e.target.value)}
                                                                placeholder="0.00"
                                                                className="w-full pl-10 pr-4 py-4 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-900 font-mono text-2xl font-bold text-slate-800 transition-all"
                                                                required
                                                                autoFocus
                                                            />
                                                        </div>
                                                        <select 
                                                            value={currency}
                                                            onChange={(e) => setCurrency(e.target.value)}
                                                            className="px-6 py-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-900 cursor-pointer"
                                                        >
                                                            <option value="ARS">ARS</option>
                                                            <option value="USD">USD</option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="block text-xs font-bold text-slate-400 uppercase mb-2 ml-1">Fecha</label>
                                                        <input 
                                                            type="date"
                                                            value={date}
                                                            onChange={(e) => setDate(e.target.value)}
                                                            className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-900"
                                                        />
                                                    </div>
                                                    {type === 'expense' && (
                                                        <div>
                                                            <label className="block text-xs font-bold text-slate-400 uppercase mb-2 ml-1">Categoría</label>
                                                            {!isCustomCat ? (
                                                                <div className="flex gap-2">
                                                                    <select 
                                                                        value={category}
                                                                        onChange={(e) => setCategory(e.target.value)}
                                                                        className="flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-900 cursor-pointer"
                                                                    >
                                                                        {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                                                    </select>
                                                                    <button 
                                                                        type="button" 
                                                                        onClick={() => setIsCustomCat(true)}
                                                                        className="px-3 border border-slate-200 rounded-xl text-slate-400 hover:bg-slate-100 hover:text-slate-900 transition-colors"
                                                                    >
                                                                        <Icons.Plus size={20}/>
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <div className="flex gap-2 fade-in">
                                                                    <input 
                                                                        type="text" 
                                                                        value={customCategory}
                                                                        onChange={(e) => setCustomCategory(e.target.value)}
                                                                        placeholder="Nueva..."
                                                                        className="flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-900"
                                                                        autoFocus
                                                                    />
                                                                    <button 
                                                                        type="button" 
                                                                        onClick={() => setIsCustomCat(false)}
                                                                        className="px-3 border border-slate-200 rounded-xl text-slate-500 hover:bg-slate-50"
                                                                    >
                                                                        <Icons.X size={20}/>
                                                                    </button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>

                                                <Button type="submit" className="w-full py-5 text-lg mt-4 shadow-xl shadow-slate-900/10">
                                                    Guardar {type === 'expense' ? 'Gasto' : 'Ingreso'}
                                                </Button>
                                            </form>
                                        </Card>
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>

                    {/* Modal Zen AI */}
                    <Modal isOpen={!!aiAdvice} onClose={() => setAiAdvice(null)} title="🤖 Análisis Financiero">
                        <div className="whitespace-pre-line text-slate-600 leading-relaxed text-sm">
                            {aiAdvice}
                        </div>
                        <div className="mt-6">
                            <Button onClick={() => setAiAdvice(null)} variant="secondary" className="w-full">
                                Cerrar
                            </Button>
                        </div>
                    </Modal>

                    {/* Navegación Móvil */}
                    <nav className="md:hidden fixed bottom-0 w-full bg-white border-t border-slate-200 pb-safe pt-2 px-6 flex justify-around items-center z-50 h-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                        <button onClick={() => setView('dashboard')} className={`flex flex-col items-center gap-1 ${view === 'dashboard' ? 'text-slate-900' : 'text-slate-400'}`}>
                            <Icons.LayoutDashboard size={24} strokeWidth={view === 'dashboard' ? 2.5 : 2} />
                        </button>
                        <button onClick={() => setView('entry')} className="bg-slate-900 text-white rounded-full p-3 shadow-lg -mt-8">
                            <Icons.Plus size={28} />
                        </button>
                        <button onClick={() => setView('budgets')} className={`flex flex-col items-center gap-1 ${view === 'budgets' ? 'text-slate-900' : 'text-slate-400'}`}>
                            <Icons.Target size={24} strokeWidth={view === 'budgets' ? 2.5 : 2} />
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>