<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Zen</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Prop-types & Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Estilos -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* Scrollbar sutil */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { 
            PieChart, Pie, Cell, ResponsiveContainer, Tooltip: RechartsTooltip, Legend,
            BarChart, Bar, XAxis, YAxis, CartesianGrid, AreaChart, Area 
        } = window.Recharts || {};

        // --- Iconos (SVG) ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );
        const Icons = {
            Plus: (p) => <Icon {...p} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Dashboard: (p) => <Icon {...p} path={<><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></>} />,
            Wallet: (p) => <Icon {...p} path={<><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></>} />,
            Trash: (p) => <Icon {...p} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            TrendingUp: (p) => <Icon {...p} path={<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>} />,
            LogOut: (p) => <Icon {...p} path={<><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></>} />,
            User: (p) => <Icon {...p} path={<><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
            Settings: (p) => <Icon {...p} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            List: (p) => <Icon {...p} path={<><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></>} />,
            CreditCard: (p) => <Icon {...p} path={<rect width="20" height="14" x="2" y="5" rx="2" ry="2"/>} />,
            PieChart: (p) => <Icon {...p} path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></>} />,
            ChevronLeft: (p) => <Icon {...p} path={<polyline points="15 18 9 12 15 6" />} />,
            Menu: (p) => <Icon {...p} path={<><line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="18" y2="18"/></>} />,
            Users: (p) => <Icon {...p} path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>} />,
            Download: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            Upload: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />,
            ArrowRight: (p) => <Icon {...p} path={<><line x1="5" x2="19" y1="12" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />,
        };

        // --- Utils ---
        const formatMoney = (amount, currency) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: currency, maximumFractionDigits: 0 }).format(amount);
        const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#6366f1', '#14b8a6'];
        
        const DEFAULT_CATEGORIES = ["Comida", "Transporte", "Hogar", "Servicios", "Entretenimiento", "Salud", "Educación"];
        const PAYMENT_METHODS = ["Efectivo", "Débito", "Crédito", "Transferencia", "QR", "Otro"];

        // --- App Component ---
        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [transactions, setTransactions] = useState([]);
            const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
            const [loading, setLoading] = useState(true);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);

            // Cargar datos locales al inicio
            useEffect(() => {
                const savedUser = localStorage.getItem('finanzas_user');
                const savedTx = localStorage.getItem('finanzas_data');
                const savedCats = localStorage.getItem('finanzas_cats');

                if (savedUser) setUser(JSON.parse(savedUser));
                if (savedTx) setTransactions(JSON.parse(savedTx));
                if (savedCats) setCategories(JSON.parse(savedCats));
                
                setLoading(false);
            }, []);

            // Guardar cambios en localStorage automáticamente
            useEffect(() => {
                if (user) localStorage.setItem('finanzas_user', JSON.stringify(user));
                localStorage.setItem('finanzas_data', JSON.stringify(transactions));
                localStorage.setItem('finanzas_cats', JSON.stringify(categories));
            }, [user, transactions, categories]);

            // --- Handlers ---
            const handleLogin = (name) => {
                setUser({ displayName: name });
            };

            const handleLogout = () => {
                if(confirm("¿Estás seguro de cerrar sesión? Deberás ingresar tu nombre nuevamente.")) {
                    localStorage.removeItem('finanzas_user'); // Borramos solo la sesión
                    setUser(null);
                }
            };

            const addTransaction = (data) => {
                setTransactions(prev => {
                    const newTx = [...prev, { ...data, id: crypto.randomUUID() }];
                    return newTx.sort((a, b) => new Date(b.date) - new Date(a.date));
                });
                setView('dashboard');
            };

            const deleteTransaction = (id) => {
                if(confirm("¿Borrar este movimiento?")) {
                    setTransactions(prev => prev.filter(t => t.id !== id));
                }
            };

            const updateCategories = (newCats) => {
                setCategories(newCats);
            };

            const importData = (data) => {
                try {
                    const parsed = JSON.parse(data);
                    if(parsed.transactions) setTransactions(parsed.transactions);
                    if(parsed.categories) setCategories(parsed.categories);
                    alert("Datos importados correctamente.");
                } catch(e) {
                    alert("Error al importar: Archivo inválido.");
                }
            };

            // --- Renders ---
            if (loading) return <div className="h-screen flex items-center justify-center bg-slate-50 text-slate-400 animate-pulse">Cargando Zen...</div>;

            if (!user) return <LoginScreen onLogin={handleLogin} />;

            return (
                <div className="flex h-screen bg-slate-50 text-slate-800 overflow-hidden font-sans">
                    {/* Sidebar para Desktop */}
                    {isSidebarOpen && (
                        <Sidebar 
                            view={view} 
                            setView={setView} 
                            onLogout={handleLogout} 
                            user={user} 
                            onClose={() => setIsSidebarOpen(false)}
                        />
                    )}
                    
                    <main className="flex-1 overflow-y-auto relative transition-all duration-300">
                        {/* Botón flotante para abrir Sidebar cuando está cerrado */}
                        {!isSidebarOpen && (
                            <button 
                                onClick={() => setIsSidebarOpen(true)}
                                className="absolute top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md border border-slate-200 text-slate-500 hover:text-slate-900 hover:bg-slate-50 transition-colors"
                                title="Abrir Menú"
                            >
                                <Icons.Menu size={20} />
                            </button>
                        )}

                        <div className={`h-full ${!isSidebarOpen ? 'max-w-7xl mx-auto' : ''}`}>
                            {view === 'dashboard' && (
                                <Dashboard 
                                    transactions={transactions} 
                                    onDelete={deleteTransaction} 
                                    setView={setView} 
                                    fullWidth={!isSidebarOpen}
                                />
                            )}
                            {view === 'entry' && (
                                <EntryForm 
                                    categories={categories} 
                                    onSubmit={addTransaction} 
                                    onCancel={() => setView('dashboard')} 
                                />
                            )}
                            {view === 'categories' && (
                                <CategoryManager 
                                    categories={categories} 
                                    onUpdate={updateCategories} 
                                />
                            )}
                            {view === 'split' && (
                                <SplitBillTool />
                            )}
                            {view === 'settings' && (
                                <SettingsView 
                                    transactions={transactions} 
                                    categories={categories} 
                                    onImport={importData}
                                />
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        // --- Sub-Components ---

        function LoginScreen({ onLogin }) {
            const [name, setName] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if(name.trim()) onLogin(name.trim());
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-900 p-4">
                    <div className="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl text-center space-y-6 slide-up">
                        <div className="w-16 h-16 bg-emerald-500 rounded-2xl mx-auto flex items-center justify-center text-white shadow-lg shadow-emerald-500/30">
                            <Icons.Wallet size={32} />
                        </div>
                        <div>
                            <h1 className="text-3xl font-bold text-slate-900 mb-2">Bienvenido</h1>
                            <p className="text-slate-500">Finanzas Zen - Modo Local</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input 
                                type="text" 
                                value={name} 
                                onChange={(e) => setName(e.target.value)} 
                                placeholder="¿Cómo te llamas?" 
                                className="w-full px-4 py-3 border border-slate-200 rounded-xl text-center font-medium focus:ring-2 focus:ring-emerald-500 outline-none"
                                autoFocus
                            />
                            <button 
                                type="submit"
                                disabled={!name.trim()}
                                className="w-full py-4 px-6 bg-slate-900 text-white hover:bg-slate-800 rounded-xl font-bold transition-all shadow-sm hover:shadow-md disabled:opacity-50"
                            >
                                Ingresar
                            </button>
                        </form>
                        <p className="text-xs text-slate-400">
                            Tus datos se guardan únicamente en este dispositivo.
                        </p>
                    </div>
                </div>
            );
        }

        function Sidebar({ view, setView, onLogout, user, onClose }) {
            const MenuBtn = ({ id, icon: IconC, label }) => (
                <button 
                    onClick={() => setView(id)}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium text-sm ${view === id ? 'bg-slate-900 text-white shadow-lg shadow-slate-200' : 'text-slate-500 hover:bg-slate-100 hover:text-slate-900'}`}
                >
                    <IconC size={20} /> {label}
                </button>
            );

            const userInitial = (user.displayName || 'U')[0].toUpperCase();

            return (
                <aside className="w-64 bg-white border-r border-slate-200 hidden md:flex flex-col p-6 z-20 shadow-sm relative h-full">
                    <button 
                        onClick={onClose}
                        className="absolute top-6 right-4 text-slate-300 hover:text-slate-600 transition-colors"
                        title="Ocultar barra"
                    >
                        <Icons.ChevronLeft size={20} />
                    </button>

                    <div className="flex items-center gap-3 mb-10 pl-2">
                        <div className="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center text-white">
                            <span className="font-bold text-lg">$</span>
                        </div>
                        <div>
                            <h1 className="font-bold text-slate-900 leading-none">Finanzas</h1>
                            <span className="text-[10px] font-bold text-emerald-500 tracking-wider uppercase">Zen</span>
                        </div>
                    </div>
                    
                    <nav className="flex-1 space-y-2">
                        <MenuBtn id="dashboard" icon={Icons.Dashboard} label="Dashboard" />
                        <MenuBtn id="entry" icon={Icons.Plus} label="Nuevo Movimiento" />
                        <MenuBtn id="split" icon={Icons.Users} label="Dividir Cuenta" />
                        <MenuBtn id="categories" icon={Icons.List} label="Categorías" />
                        <MenuBtn id="settings" icon={Icons.Settings} label="Configuración" />
                    </nav>

                    <div className="pt-6 border-t border-slate-100 mt-auto">
                        <div className="flex items-center gap-3 mb-4 px-2">
                            <div className="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold">
                                {userInitial}
                            </div>
                            <div className="flex-1 min-w-0">
                                <p className="text-sm font-bold text-slate-800 truncate">{user.displayName}</p>
                                <p className="text-xs text-slate-400 truncate">Modo Local</p>
                            </div>
                        </div>
                        <button onClick={onLogout} className="flex items-center gap-2 text-xs font-bold text-slate-400 hover:text-slate-600 px-2">
                            <Icons.LogOut size={14} /> Cambiar Usuario
                        </button>
                    </div>
                </aside>
            );
        }

        function Dashboard({ transactions, onDelete, setView, fullWidth }) {
            const [month, setMonth] = useState(new Date().toISOString().slice(0, 7));
            const [currencyView, setCurrencyView] = useState('ARS'); // Toggle: 'ARS' | 'USD'
            
            // 1. Filtrar por MES
            const transactionsByMonth = useMemo(() => {
                return transactions.filter(t => t.date.startsWith(month));
            }, [transactions, month]);

            // 2. Filtrar por MONEDA (Para totales y gráficos)
            const transactionsByCurrency = useMemo(() => {
                return transactionsByMonth.filter(t => t.currency === currencyView);
            }, [transactionsByMonth, currencyView]);
            
            // 3. Totales (basados en la moneda seleccionada)
            const totals = useMemo(() => {
                const inc = transactionsByCurrency.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
                const exp = transactionsByCurrency.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
                return { income: inc, expense: exp, balance: inc - exp };
            }, [transactionsByCurrency]);

            // 4. Datos Torta (basado en la moneda seleccionada)
            const expensesByCategory = useMemo(() => {
                const data = {};
                transactionsByCurrency
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        const key = t.category;
                        if (!data[key]) data[key] = 0;
                        data[key] += t.amount;
                    });
                return Object.keys(data).map(key => ({ name: key, value: data[key] }));
            }, [transactionsByCurrency]);

            // 5. Histórico (basado en moneda seleccionada - últimos 6 meses)
            const monthlyData = useMemo(() => {
                const data = [];
                for (let i = 5; i >= 0; i--) {
                    const d = new Date();
                    d.setMonth(d.getMonth() - i);
                    const monthStr = d.toISOString().slice(0, 7);
                    
                    // Aquí filtramos por la fecha del loop Y la moneda seleccionada globalmente
                    const inc = transactions.filter(t => t.date.startsWith(monthStr) && t.type === 'income' && t.currency === currencyView).reduce((s, t) => s + t.amount, 0);
                    const exp = transactions.filter(t => t.date.startsWith(monthStr) && t.type === 'expense' && t.currency === currencyView).reduce((s, t) => s + t.amount, 0);
                    
                    data.push({
                        name: d.toLocaleDateString('es-AR', { month: 'short' }),
                        Ingresos: inc,
                        Gastos: exp
                    });
                }
                return data;
            }, [transactions, currencyView]); // Depende de toda la data y del toggle

            return (
                <div className={`p-6 space-y-8 fade-in pb-24 md:pb-6 ${fullWidth ? 'pt-16' : ''}`}>
                    
                    {/* Header: Título + Filtros */}
                    <header className="flex flex-col xl:flex-row xl:items-center justify-between gap-6">
                        <div className={fullWidth ? 'pl-8 md:pl-0' : ''}>
                            <h2 className="text-2xl font-bold text-slate-800">Resumen Mensual</h2>
                            <p className="text-slate-500 text-sm">Visualiza el flujo de tu dinero.</p>
                        </div>
                        
                        <div className="flex flex-col sm:flex-row gap-4">
                            {/* Toggle Moneda */}
                            <div className="bg-white p-1 rounded-xl border border-slate-200 flex">
                                {['ARS', 'USD'].map(curr => (
                                    <button
                                        key={curr}
                                        onClick={() => setCurrencyView(curr)}
                                        className={`px-4 py-1.5 rounded-lg text-sm font-bold transition-all ${currencyView === curr ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:text-slate-800'}`}
                                    >
                                        {curr}
                                    </button>
                                ))}
                            </div>

                            <div className="flex items-center gap-2">
                                <input 
                                    type="month" 
                                    value={month} 
                                    onChange={(e) => setMonth(e.target.value)}
                                    className="bg-white border border-slate-200 rounded-xl px-4 py-2 text-sm font-medium text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-slate-900 cursor-pointer w-full sm:w-auto"
                                />
                                <button onClick={() => setView('entry')} className="bg-slate-900 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg shadow-slate-200 hover:bg-slate-800 transition-colors flex items-center gap-2 whitespace-nowrap">
                                    <Icons.Plus size={16} /> Nuevo
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* KPIs (Afectados por el Toggle) */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                            <p className="text-sm font-medium text-emerald-600 mb-1">Ingresos ({currencyView})</p>
                            <p className="text-3xl font-bold text-slate-900">+{formatMoney(totals.income, currencyView)}</p>
                        </div>
                        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                            <p className="text-sm font-medium text-rose-600 mb-1">Gastos ({currencyView})</p>
                            <p className="text-3xl font-bold text-slate-900">-{formatMoney(totals.expense, currencyView)}</p>
                        </div>
                        <div className="bg-slate-900 p-6 rounded-2xl text-white shadow-xl shadow-slate-200">
                            <p className="text-sm font-medium text-slate-400 mb-1">Balance ({currencyView})</p>
                            <p className="text-3xl font-bold">{formatMoney(totals.balance, currencyView)}</p>
                        </div>
                    </div>

                    {/* Gráficos (Afectados por el Toggle) */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-auto lg:h-[400px]">
                        {/* Gráfico Histórico */}
                        <div className="lg:col-span-2 bg-white rounded-2xl border border-slate-100 shadow-sm p-6 flex flex-col h-[400px] lg:h-auto">
                            <h3 className="text-slate-800 font-bold mb-6 flex items-center gap-2">
                                <Icons.TrendingUp size={20} className="text-emerald-500"/> Flujo en {currencyView} (6 meses)
                            </h3>
                            <div className="flex-1 min-h-0">
                                <ResponsiveContainer width="100%" height="100%">
                                    <AreaChart data={monthlyData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
                                        <defs>
                                            <linearGradient id="colorIngresos" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#10b981" stopOpacity={0.1}/>
                                                <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                                            </linearGradient>
                                            <linearGradient id="colorGastos" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#ef4444" stopOpacity={0.1}/>
                                                <stop offset="95%" stopColor="#ef4444" stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                        <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 12}} />
                                        <YAxis axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 12}} />
                                        <RechartsTooltip contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'}} formatter={(val) => formatMoney(val, currencyView)} />
                                        <Area type="monotone" dataKey="Ingresos" stroke="#10b981" strokeWidth={3} fillOpacity={1} fill="url(#colorIngresos)" />
                                        <Area type="monotone" dataKey="Gastos" stroke="#ef4444" strokeWidth={3} fillOpacity={1} fill="url(#colorGastos)" />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Gráfico Categorías */}
                        <div className="bg-white rounded-2xl border border-slate-100 shadow-sm p-6 flex flex-col h-[400px] lg:h-auto">
                            <h3 className="text-slate-800 font-bold mb-6 flex items-center gap-2">
                                <Icons.PieChart size={20} className="text-blue-500"/> Gastos en {currencyView}
                            </h3>
                            <div className="flex-1 min-h-0">
                                {expensesByCategory.length > 0 ? (
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie
                                                data={expensesByCategory}
                                                innerRadius={60}
                                                outerRadius={80}
                                                paddingAngle={5}
                                                dataKey="value"
                                            >
                                                {expensesByCategory.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                                ))}
                                            </Pie>
                                            <RechartsTooltip formatter={(value) => formatMoney(value, currencyView)} contentStyle={{borderRadius: '12px'}}/>
                                            <Legend verticalAlign="bottom" height={36}/>
                                        </PieChart>
                                    </ResponsiveContainer>
                                ) : (
                                    <div className="h-full flex items-center justify-center text-slate-400 text-sm italic">
                                        Sin gastos en {currencyView}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Tabla Detallada (Muestra SÓLO la moneda seleccionada) */}
                    <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                        <div className="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                            <h3 className="font-bold text-slate-800">Movimientos en {currencyView}</h3>
                            <span className="text-xs font-medium text-slate-400">{transactionsByCurrency.length} registros</span>
                        </div>
                        
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-100">
                                    <tr>
                                        <th className="px-6 py-3 font-medium">Fecha</th>
                                        <th className="px-6 py-3 font-medium">Categoría / Detalle</th>
                                        <th className="px-6 py-3 font-medium">Método</th>
                                        <th className="px-6 py-3 font-medium text-right">Monto</th>
                                        <th className="px-6 py-3 text-center"></th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-50">
                                    {transactionsByCurrency.length === 0 ? (
                                        <tr>
                                            <td colSpan="5" className="text-center py-12 text-slate-400 italic">
                                                No hay movimientos en {currencyView} este mes.
                                            </td>
                                        </tr>
                                    ) : (
                                        transactionsByCurrency.map(t => (
                                            <tr key={t.id} className="hover:bg-slate-50/80 transition-colors">
                                                <td className="px-6 py-4 text-slate-500 whitespace-nowrap">
                                                    {new Date(t.date).toLocaleDateString('es-AR', {day: '2-digit', month: 'short'})}
                                                </td>
                                                <td className="px-6 py-4">
                                                    <div className="font-bold text-slate-700">{t.category}</div>
                                                    <div className="text-xs text-slate-400 truncate max-w-[200px]">{t.detail || '-'}</div>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-600">
                                                        {t.paymentMethod || 'Efectivo'}
                                                    </span>
                                                </td>
                                                <td className={`px-6 py-4 text-right font-bold ${t.type === 'income' ? 'text-emerald-600' : 'text-rose-600'}`}>
                                                    {t.type === 'income' ? '+' : '-'}{formatMoney(t.amount, t.currency)}
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    <button onClick={() => onDelete(t.id)} className="p-2 text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-lg transition-all">
                                                        <Icons.Trash size={16} />
                                                    </button>
                                                </td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        function EntryForm({ categories, onSubmit, onCancel }) {
            const [amount, setAmount] = useState('');
            const [type, setType] = useState('expense');
            const [category, setCategory] = useState(categories[0] || 'Varios');
            const [detail, setDetail] = useState('');
            const [paymentMethod, setPaymentMethod] = useState('Efectivo');
            const [currency, setCurrency] = useState('ARS');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if(!amount) return;
                onSubmit({
                    amount: parseFloat(amount),
                    type,
                    category: type === 'income' ? 'Ingreso' : category,
                    detail,
                    paymentMethod,
                    currency,
                    date,
                    createdAt: new Date().toISOString()
                });
            };

            return (
                <div className="max-w-lg mx-auto py-10 px-4 slide-up pb-24 md:pb-10 pt-16">
                    <button onClick={onCancel} className="mb-6 text-sm font-bold text-slate-400 hover:text-slate-600 flex items-center gap-1">
                        ← Volver
                    </button>
                    <div className="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-8">
                        <h2 className="text-2xl font-bold text-slate-800 mb-6 text-center">Nuevo Movimiento</h2>
                        
                        <div className="flex bg-slate-100 p-1 rounded-xl mb-6">
                            <button onClick={() => setType('expense')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${type === 'expense' ? 'bg-white shadow text-rose-600' : 'text-slate-500'}`}>Egreso</button>
                            <button onClick={() => setType('income')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${type === 'income' ? 'bg-white shadow text-emerald-600' : 'text-slate-500'}`}>Ingreso</button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-5">
                            {/* Monto */}
                            <div>
                                <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Monto</label>
                                <div className="flex gap-2">
                                    <div className="relative flex-1">
                                        <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 font-bold text-lg">$</span>
                                        <input type="number" step="0.01" value={amount} onChange={e => setAmount(e.target.value)} placeholder="0.00" className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-slate-900 font-mono text-2xl font-bold text-slate-800" required autoFocus />
                                    </div>
                                    <select value={currency} onChange={e => setCurrency(e.target.value)} className="px-3 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-700">
                                        <option value="ARS">ARS</option>
                                        <option value="USD">USD</option>
                                    </select>
                                </div>
                            </div>

                            {/* Detalle y Fecha */}
                            <div className="grid grid-cols-2 gap-4">
                                <div className="col-span-2">
                                    <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Detalle (Opcional)</label>
                                    <input type="text" value={detail} onChange={e => setDetail(e.target.value)} placeholder="Ej: Cena con amigos..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Fecha</label>
                                    <input type="date" value={date} onChange={e => setDate(e.target.value)} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 text-sm" required />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Método Pago</label>
                                    <select value={paymentMethod} onChange={e => setPaymentMethod(e.target.value)} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 text-sm">
                                        {PAYMENT_METHODS.map(m => <option key={m} value={m}>{m}</option>)}
                                    </select>
                                </div>
                            </div>

                            {/* Categoría */}
                            {type === 'expense' && (
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Categoría</label>
                                    <select value={category} onChange={e => setCategory(e.target.value)} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700">
                                        {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                    </select>
                                </div>
                            )}

                            <button type="submit" className="w-full py-4 bg-slate-900 text-white rounded-xl font-bold text-lg shadow-xl shadow-slate-900/10 hover:bg-slate-800 transition-all mt-4">
                                Guardar
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // --- NEW: SPLIT BILL TOOL (IMPROVED) ---
        function SplitBillTool() {
            const [people, setPeople] = useState(['Yo']);
            const [newPerson, setNewPerson] = useState('');
            const [items, setItems] = useState([]);
            const [newItemName, setNewItemName] = useState('');
            const [newItemPrice, setNewItemPrice] = useState('');
            const [newItemPayer, setNewItemPayer] = useState(''); // NEW: Who Paid
            const [newItemConsumers, setNewItemConsumers] = useState({}); 

            // Initialize default payer when people list changes
            useEffect(() => {
                if(people.length > 0 && !newItemPayer) {
                    setNewItemPayer(people[0]);
                }
            }, [people]);

            const addPerson = (e) => {
                e.preventDefault();
                if(newPerson.trim() && !people.includes(newPerson.trim())) {
                    setPeople([...people, newPerson.trim()]);
                    setNewPerson('');
                }
            };

            const addItem = (e) => {
                e.preventDefault();
                if(!newItemName || !newItemPrice || !newItemPayer) return;
                
                const selected = Object.keys(newItemConsumers).filter(k => newItemConsumers[k]);
                const consumers = selected.length > 0 ? selected : people;

                setItems([...items, {
                    id: crypto.randomUUID(),
                    name: newItemName,
                    price: parseFloat(newItemPrice),
                    payer: newItemPayer,
                    consumers: consumers
                }]);
                setNewItemName('');
                setNewItemPrice('');
                setNewItemConsumers({});
            };

            const removeItem = (id) => setItems(items.filter(i => i.id !== id));

            // CALCULATE TOTALS & SETTLEMENTS
            const results = useMemo(() => {
                const consumed = {}; // Costo total consumido por cada uno
                const paid = {};     // Total pagado de su bolsillo por cada uno
                let totalTicket = 0;

                // Init maps
                people.forEach(p => {
                    consumed[p] = 0;
                    paid[p] = 0;
                });

                // Process items
                items.forEach(item => {
                    totalTicket += item.price;
                    
                    // Add to payer's paid amount
                    if(paid[item.payer] !== undefined) paid[item.payer] += item.price;

                    // Add to consumers' cost
                    const costPerPerson = item.price / item.consumers.length;
                    item.consumers.forEach(p => {
                        if(consumed[p] !== undefined) consumed[p] += costPerPerson;
                    });
                });

                // Calculate balances (Paid - Consumed)
                // Positive = Owed to them (Creditor)
                // Negative = They owe (Debtor)
                let debtors = [];
                let creditors = [];

                people.forEach(p => {
                    const balance = paid[p] - consumed[p];
                    if(balance < -0.01) debtors.push({ name: p, amount: Math.abs(balance) });
                    if(balance > 0.01) creditors.push({ name: p, amount: balance });
                });

                // Generate Settlement Transactions
                const settlements = [];
                // Sort to optimize matching
                debtors.sort((a, b) => b.amount - a.amount);
                creditors.sort((a, b) => b.amount - a.amount);

                let i = 0; // debtor index
                let j = 0; // creditor index

                while(i < debtors.length && j < creditors.length) {
                    const debtor = debtors[i];
                    const creditor = creditors[j];
                    
                    const amount = Math.min(debtor.amount, creditor.amount);
                    
                    if(amount > 0.01) {
                        settlements.push({
                            from: debtor.name,
                            to: creditor.name,
                            amount: amount
                        });
                    }

                    debtor.amount -= amount;
                    creditor.amount -= amount;

                    if(debtor.amount < 0.01) i++;
                    if(creditor.amount < 0.01) j++;
                }

                return { consumed, paid, totalTicket, settlements };
            }, [items, people]);

            return (
                <div className="max-w-6xl mx-auto py-10 px-6 fade-in pb-24 md:pb-10 pt-16">
                    <h2 className="text-2xl font-bold text-slate-800 mb-2">Dividir Cuenta Inteligente</h2>
                    <p className="text-slate-500 mb-8">Define quién pagó qué y quién consumió qué. La app ajusta los saldos.</p>

                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-10 items-start">
                        {/* LEFT: Inputs */}
                        <div className="space-y-8">
                            {/* 1. Personas */}
                            <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><span className="bg-slate-900 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span> Participantes</h3>
                                <div className="flex flex-wrap gap-2 mb-4">
                                    {people.map(p => (
                                        <span key={p} className="bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1 border border-slate-200">
                                            {p}
                                        </span>
                                    ))}
                                </div>
                                <form onSubmit={addPerson} className="flex gap-2">
                                    <input 
                                        type="text" 
                                        value={newPerson} 
                                        onChange={e => setNewPerson(e.target.value)} 
                                        placeholder="Nombre..." 
                                        className="flex-1 px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none"
                                    />
                                    <button type="submit" className="bg-slate-900 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-md hover:bg-slate-800">+</button>
                                </form>
                            </div>

                            {/* 2. Ítems */}
                            <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><span className="bg-slate-900 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span> Cargar Gastos</h3>
                                <form onSubmit={addItem} className="space-y-4">
                                    <div className="grid grid-cols-2 gap-2">
                                        <div className="col-span-2">
                                            <label className="text-xs font-bold text-slate-400 uppercase mb-1 block">Ítem</label>
                                            <input 
                                                type="text" 
                                                value={newItemName} 
                                                onChange={e => setNewItemName(e.target.value)} 
                                                placeholder="Ej: Asado, Bebidas..." 
                                                className="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-400 uppercase mb-1 block">Precio</label>
                                            <input 
                                                type="number" 
                                                value={newItemPrice} 
                                                onChange={e => setNewItemPrice(e.target.value)} 
                                                placeholder="$" 
                                                className="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-400 uppercase mb-1 block">¿Quién pagó?</label>
                                            <select 
                                                value={newItemPayer} 
                                                onChange={e => setNewItemPayer(e.target.value)}
                                                className="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none"
                                            >
                                                {people.map(p => <option key={p} value={p}>{p}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="text-xs font-bold text-slate-400 uppercase mb-2 block">¿Quiénes consumieron? <span className="text-[10px] font-normal lowercase">(vacío = todos)</span></label>
                                        <div className="flex flex-wrap gap-2">
                                            {people.map(p => (
                                                <label key={p} className={`px-3 py-1 rounded-lg text-xs font-bold cursor-pointer transition-all border select-none ${newItemConsumers[p] ? 'bg-emerald-500 text-white border-emerald-500 shadow-sm' : 'bg-white text-slate-500 border-slate-200 hover:border-slate-400'}`}>
                                                    <input 
                                                        type="checkbox" 
                                                        className="hidden"
                                                        checked={!!newItemConsumers[p]}
                                                        onChange={e => setNewItemConsumers({...newItemConsumers, [p]: e.target.checked})}
                                                    />
                                                    {p}
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    <button type="submit" className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold shadow-lg shadow-slate-200 hover:bg-slate-800 transition-colors mt-2">
                                        Agregar al Ticket
                                    </button>
                                </form>
                            </div>
                        </div>

                        {/* RIGHT: Results */}
                        <div className="space-y-6">
                            
                            {/* Ticket List */}
                            <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                <div className="flex justify-between items-center mb-4 pb-2 border-b border-slate-200">
                                    <h3 className="font-bold text-slate-700">Detalle del Ticket</h3>
                                    <span className="text-xl font-black text-slate-800">{formatMoney(results.totalTicket, 'ARS')}</span>
                                </div>
                                
                                {items.length === 0 ? <p className="text-sm text-slate-400 italic text-center py-4">Agrega gastos para ver el detalle.</p> : (
                                    <ul className="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                                        {items.map(item => (
                                            <li key={item.id} className="bg-white p-3 rounded-xl border border-slate-200 text-sm flex justify-between items-center shadow-sm">
                                                <div className="flex-1">
                                                    <div className="font-bold text-slate-800 flex justify-between pr-4">
                                                        <span>{item.name}</span>
                                                        <span>{formatMoney(item.price, 'ARS')}</span>
                                                    </div>
                                                    <div className="text-xs text-slate-500 mt-1 flex items-center gap-2">
                                                        <span className="bg-slate-100 px-1.5 rounded text-[10px] font-bold">Pagó: {item.payer}</span>
                                                        <span>→</span>
                                                        <span className="text-[10px] truncate max-w-[150px]">{item.consumers.join(', ')}</span>
                                                    </div>
                                                </div>
                                                <button onClick={() => removeItem(item.id)} className="text-slate-300 hover:text-rose-500 p-1"><Icons.Trash size={16}/></button>
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>

                            {/* Resumen por Persona */}
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                                    <h4 className="text-xs font-bold text-slate-400 uppercase mb-3">Consumo Total</h4>
                                    <ul className="space-y-2 text-sm">
                                        {people.map(p => (
                                            <li key={p} className="flex justify-between">
                                                <span>{p}</span>
                                                <span className="font-medium text-slate-700">{formatMoney(results.consumed[p], 'ARS')}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                <div className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                                    <h4 className="text-xs font-bold text-slate-400 uppercase mb-3">Pagado de Bolsillo</h4>
                                    <ul className="space-y-2 text-sm">
                                        {people.map(p => (
                                            <li key={p} className="flex justify-between">
                                                <span>{p}</span>
                                                <span className="font-medium text-slate-700">{formatMoney(results.paid[p], 'ARS')}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>

                            {/* Ajuste de Cuentas (Settlement) */}
                            <div className="bg-slate-900 p-6 rounded-2xl text-white shadow-xl shadow-slate-200">
                                <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                                    <Icons.Wallet size={20} className="text-emerald-400"/> Ajuste de Cuentas
                                </h3>
                                {results.settlements.length === 0 ? (
                                    <p className="text-sm text-slate-400">¡Todo está saldado! Nadie debe nada.</p>
                                ) : (
                                    <div className="space-y-3">
                                        {results.settlements.map((tx, idx) => (
                                            <div key={idx} className="flex items-center justify-between text-sm bg-slate-800/50 p-3 rounded-xl border border-slate-700">
                                                <div className="flex items-center gap-2">
                                                    <span className="font-bold text-rose-300">{tx.from}</span>
                                                    <span className="text-slate-400 text-xs">le paga a</span>
                                                    <span className="font-bold text-emerald-300">{tx.to}</span>
                                                </div>
                                                <span className="font-bold text-lg">{formatMoney(tx.amount, 'ARS')}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        // --- NEW: SETTINGS / EXPORT VIEW ---
        function SettingsView({ transactions, categories, onImport }) {
            const downloadData = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({ transactions, categories }));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "finanzas_zen_backup.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const handleFileChange = (e) => {
                const fileReader = new FileReader();
                fileReader.readAsText(e.target.files[0], "UTF-8");
                fileReader.onload = (e) => {
                    onImport(e.target.result);
                };
            };

            return (
                <div className="max-w-2xl mx-auto py-10 px-6 fade-in pb-24 md:pb-10 pt-16">
                    <h2 className="text-2xl font-bold text-slate-800 mb-2">Configuración & Datos</h2>
                    <p className="text-slate-500 mb-8">Administra y protege tu información.</p>

                    <div className="space-y-6">
                        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex items-center justify-between">
                            <div>
                                <h3 className="font-bold text-slate-800">Exportar Datos</h3>
                                <p className="text-xs text-slate-400 mt-1">Descarga un archivo JSON con todo tu historial.</p>
                            </div>
                            <button onClick={downloadData} className="flex items-center gap-2 bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-xl text-sm font-bold transition-colors">
                                <Icons.Download size={18} /> Descargar
                            </button>
                        </div>

                        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex items-center justify-between">
                            <div>
                                <h3 className="font-bold text-slate-800">Importar Datos</h3>
                                <p className="text-xs text-slate-400 mt-1">Restaura una copia de seguridad.</p>
                            </div>
                            <label className="cursor-pointer flex items-center gap-2 bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-xl text-sm font-bold transition-colors">
                                <Icons.Upload size={18} /> Subir Archivo
                                <input type="file" onChange={handleFileChange} className="hidden" accept=".json" />
                            </label>
                        </div>
                        
                        <div className="bg-amber-50 p-4 rounded-xl border border-amber-100 text-amber-800 text-xs">
                            <strong>Nota importante:</strong> Tus datos están guardados solo en este navegador. Si borras el historial/caché, podrías perderlos. ¡Haz copias de seguridad regularmente!
                        </div>
                    </div>
                </div>
            );
        }

        function CategoryManager({ categories, onUpdate }) {
            const [newCat, setNewCat] = useState('');

            const add = (e) => {
                e.preventDefault();
                if(newCat.trim() && !categories.includes(newCat.trim())) {
                    onUpdate([...categories, newCat.trim()]);
                    setNewCat('');
                }
            };

            const remove = (cat) => {
                if(confirm(`¿Eliminar categoría "${cat}"?`)) {
                    onUpdate(categories.filter(c => c !== cat));
                }
            };

            return (
                <div className="max-w-2xl mx-auto py-10 px-6 fade-in pb-24 md:pb-10 pt-16">
                    <h2 className="text-2xl font-bold text-slate-800 mb-2">Gestionar Categorías</h2>
                    <p className="text-slate-500 mb-8">Personaliza las opciones para tus gastos.</p>

                    <form onSubmit={add} className="flex gap-2 mb-8">
                        <input 
                            type="text" 
                            value={newCat} 
                            onChange={e => setNewCat(e.target.value)} 
                            placeholder="Nueva categoría..." 
                            className="flex-1 px-4 py-3 bg-white border border-slate-200 rounded-xl shadow-sm focus:ring-2 focus:ring-slate-900"
                        />
                        <button type="submit" className="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-slate-800">
                            Agregar
                        </button>
                    </form>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {categories.map(cat => (
                            <div key={cat} className="flex items-center justify-between bg-white p-4 rounded-xl border border-slate-100 shadow-sm group hover:border-slate-300 transition-all">
                                <span className="font-medium text-slate-700">{cat}</span>
                                <button onClick={() => remove(cat)} className="text-slate-300 hover:text-rose-500 p-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <Icons.Trash size={18} />
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>